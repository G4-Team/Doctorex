{% extends 'base.html' %}
{% load static %}

{% block body %}
    <div class="container">
        <div class="main-body">
            <div class="row gutters-sm">
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center text-center">
                                <img src="{{ doctor.account.image.url }}" alt="Admin"
                                     class="rounded-circle" width="250">
                                <div class="mt-3">
                                    <h4>{{ doctor.account.first_name }} {{ doctor.account.last_name }}</h4>
                                    <p class="text-secondary mb-1" id="doctor-info">{{ doctor.specialty.specialty|upper }} |
                                        Score: {{ doctor.avg_rate|floatformat:2 }}</p>
                                    <p class="text-muted font-size-sm">{{ doctor.clinic_address }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <section class="gradient-custom pt-3">
                        <div class="row d-flex justify-content-center">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="text-center mb-4 pb-2">نظرات ثبت شده</h4>
                                        <div class="row">
                                            <div class="col" id="doctor-comments">
                                                {% for comment in comments %}
                                                    <div class="d-flex flex-start">
                                                        <img class="rounded-circle shadow-1-strong me-3"
                                                             src="{% if comment.author.image %}{{ comment.author.image.url }}{% else %}
                                                             {%  static 'assets/image/avatar.jpeg' %}
                                                             {% endif %}"
                                                             alt="avatar" width="65"
                                                             height="65"/>
                                                        <div class="flex-grow-1 flex-shrink-1">
                                                            <div>
                                                                <div class="d-flex justify-content-between align-items-center">
                                                                    <p class="mb-1">
                                                                        {{ comment.author.first_name}} {{ comment.author.last_name }}
                                                                    </p>
                                                                    {% if comment.author.id == user.id %}
                                                                    <a href="{% url 'reservation:comment-edit' comment_id=comment.id %}" disabled=""><i
                                                                            class="fas fa-reply fa-xs"></i><span
                                                                            class="small"> edit</span></a>
                                                                    {% endif %}
                                                                </div>
                                                                <p class="small mb-0">
                                                                    <strong>{{ comment.title }}</strong>
                                                                    <hr>
                                                                    {{ comment.text }}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="col-md-8">
                    <div class="card mb-3 p-5">
                        <h3 class="text-center">رزرو نوبت</h3>
                        <form action="" method="post" class="p-5" dir="rtl">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="username">نام بیمار</label>
                                <input type="text" class="form-control" name="username" id="username"
                                       placeholder="نام بیمار" value="{{ user.first_name }}" disabled>
                            </div>
                            <div class="form-group">
                                <label for="first_name">نام خانوادگی بیمار</label>
                                <input type="text" class="form-control" name="first_name" id="first_name"
                                       placeholder="نام خانوادگی بیمار" value="{{ user.last_name }}" disabled>
                            </div>
                            <div class="form-group">
                                <label for="last_name">تلفن تماس</label>
                                <input type="text" class="form-control" name="last_name" id="last_name"
                                       placeholder="تلفن تماس" value="{{ user.phone_number }}" disabled>
                            </div>
                            <div class="form-group">
                                <label for="email">پست الکترونیک</label>
                                <input type="email" class="form-control" name="email" id="email"
                                       placeholder="ایمیل خود را وارد کنید" value="{{ user.email }}" readonly>
                            </div>
                            <div class="form-group">
                                <label for="gender">جنسیت</label>
                                <select class="form-control" name="gender" id="gender" readonly="">
                                    <option value="M" {% if user.gender == "M" %} selected {% endif %}>آقا</option>
                                    <option value="F" {% if user.gender == "F" %} selected {% endif %}>خانم</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="time">نوبت های موجود</label>
                                <select class="form-control" name="time" id="time">
                                    {% for time in times %}
                                        <option value="{{ time.id }}">{{ time.date }}, {{ time.start_time }}
                                            - {{ time.end_time }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <p>موجودی شما: <strong>{{ user.balance }}</strong>, هزینه ویزیت دکتر: <strong>{{ doctor.visit_cost }}</strong></p>

                            {% if user.balance > doctor.visit_cost %}
                                <button type="submit" class="btn btn-primary btn-block">رزرو نوبت</button>
                            {% else %}
                                <a type="submit" class="btn btn-success btn-block">افزایش موجودی</a>
                            {% endif %}
                        </form>
                    </div>
                    <div class="card mb-3 p-5">
                        <h3 class="text-center">ثبت نظر</h3>
                        {% if reserved_times %}
                        <div 
                            id="new-comment"
                            hx-get={% url "reservation:comment" doctor.id %}
                            hx-trigger="load"
                            hx-swap="innerHTML"
                            hx-target="#new-comment"
                        >
                            
                        </div>
                        {% else %}
                            <p>برای ثبت نظر نسبت به عملکرد این دکتر نیاز است ابتدا از دکتر مورد نظر نوبتی دریافت کرده
                                باشید.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}