{% load static %}
{% if messages %}
    {% for msg in messages %}
        <p class="alert alert-{{ msg.tags }}"> {{ msg }} </p>
    {% endfor %}


    <p class="text-secondary mb-1" id="doctor-info" hx-swap-oob="true">{{ doctor.specialty.specialty|upper }} |
        Score: {{ doctor.avg_rate|floatformat:2 }}</p>
    <p class="text-muted font-size-sm">{{ doctor.clinic_address }}</p>

    <div class="col" id="doctor-comments" hx-swap-oob="true">
        {% for comment in comments %}
            <div class="d-flex flex-start">
                <img class="rounded-circle shadow-1-strong me-3"
                     src="{% if comment.author.image %}{{ comment.author.image.url }}{% else %}
                     {%  static 'assets/image/avatar.jpeg' %}
                     {% endif %}"
                     alt="avatar" width="65"
                     height="65"/>
                <div class="flex-grow-1 flex-shrink-1">
                    <div>
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="mb-1">
                                {{ comment.author.first_name}} {{ comment.author.last_name }}
                            </p>
                            {% if comment.author.id == user.id %}
                            <a href="{% url 'comment-edit' comment_id=comment.id %}" disabled=""><i
                                    class="fas fa-reply fa-xs"></i><span
                                    class="small"> edit</span></a>
                            {% endif %}
                        </div>
                        <p class="small mb-0">
                            <strong>{{ comment.title }}</strong>
                            <hr>
                            {{ comment.text }}
                        </p>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}
<form action="{% url 'comment' doctor_id %}" method="post" class="p-5" dir="rtl"
    hx-post="{% url 'comment' doctor_id %}"
    hx-trigger="submit"
    hx-target="#new-comment"
    hx-swap="innerHTML"
>
    {% csrf_token %}
    {% if form.errors %}
        <div class="alert alert-danger">
            {{ form.errors }}
        </div>
    {% endif %}
    <input type="hidden" value="{{doctor_id}}" name="doctor_id">
    <div class="form-group">
        <label for="username">نام بیمار</label>
        <input type="text" class="form-control" name="username" id="username"
               placeholder="نام بیمار" value="{{ user.first_name }}" disabled>
    </div>
    <div class="form-group">
        <label for="title">عنوان</label>
        <input type="text" class="form-control" name="title" id="title"
               placeholder="عنوان خود را وارد کنید">
    </div>
    <div class="form-group">
        <label for="text">متن نظر</label>
        <input type="text" class="form-control" name="text" id="text"
               placeholder="نظر خود را وارد کنید">
    </div>
    <div class="form-group">
        <label for="score">امتیاز شما به دکتر</label>
        <select class="form-control" name="score" id="score">
            {% for score in "12345"|make_list %}
                <option value="{{ score }}">{{ score }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="time">نوبت های گرفته شده از دکتر</label>
        <select class="form-control" name="time" id="time">
            {% for time in reserved_times %}
                <option value="{{ time.id }}">{{ time.visit_time.date }}, {{ time.visit_time.start_time }}
                    - {{ time.visit_time.end_time }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-success btn-block">ثبت نظر</button>
</form>